<?xml version="1.0"?>
<?xml-stylesheet href="JSBSim.xsl" type="application/xml"?>

<!--
:copyright: 2023, IAHM-COL
License: GPLv3

Redistribution, or reuse, with or without modifications
shall keep this attribution information. 
-->

<system>
  <channel name="Panel backlight status">
    <switch name="instruments/panel-lighting/backlight-active">
      <default value="0" />
      <test value="0">
	<!-- Off backlight if electrical is off -->
	/systems/electrical/serviceable EQ 0
      </test>
      <test value="0">
	<!-- OFF -->
	instruments/panel-lighting/backlight-status EQ 0
      </test>
      <test value="1">
	<!-- ON -->
	instruments/panel-lighting/backlight-status EQ 1
      </test>
      <test logic="AND" value="1">
	<!-- AUTO -->
	instruments/panel-lighting/backlight-status EQ 2
	/sim/time/sun-angle-rad GE 1.45
      </test>
    </switch>
  </channel>

  <channel name="Panel backlight intensity">
    <switch name="instruments/panel-lighting/backlight-intensity-cmd">
      <default value="instruments/panel-lighting/backlight-intensity"/>
      <test value="0">
	instruments/panel-lighting/backlight-status EQ 0
      </test>
      <test logic="OR" value="instruments/panel-lighting/backlight-intensity">
	instruments/panel-lighting/backlight-status EQ 1
	instruments/panel-lighting/backlight-status EQ 2
      </test>
    </switch>
    <pure_gain name="instruments/panel-lighting/backlight-intensity-norm">
      <input>instruments/panel-lighting/backlight-intensity-cmd</input>
      <gain>1</gain>
      <clipto>
	<min>0</min>
	<max>1</max>
      </clipto>
    </pure_gain>
  </channel>

  <channel name="Panel floodlight status">
    <switch name="instruments/panel-lighting/floodlight-active">
      <default value="0" />
      <test value="0">
	<!-- Off floodlight if electrical is off -->
	/systems/electrical/serviceable EQ 0
      </test>
      <test value="0">
	<!-- OFF -->
	instruments/panel-lighting/floodlight-status EQ 0
      </test>
      <test value="1">
	<!-- ON -->
	instruments/panel-lighting/floodlight-status EQ 1
      </test>
      <test logic="AND" value="1">
	<!-- AUTO -->
	instruments/panel-lighting/floodlight-status EQ 2
	/sim/time/sun-angle-rad GE 1.45
      </test>
    </switch>
  </channel>

  <channel name="Intensity knobs">
    <switch name="instruments/panel-lighting/floodlight-status">
      <default value="instruments/panel-lighting/floodlight-status" />
      <test value="0">
	instruments/panel-lighting/floodlight-intensity LE 0
      </test>
      <test logic="AND" value="1">
	instruments/panel-lighting/floodlight-intensity GT 0
	instruments/panel-lighting/floodlight-intensity LE 1
      </test>
      <test value="2">
	instruments/panel-lighting/floodlight-intensity GT 1
      </test>
    </switch>
    <switch name="instruments/panel-lighting/backlight-status">
      <default value="instruments/panel-lighting/backlight-status" />
      <test value="0">
	instruments/panel-lighting/backlight-intensity LE 0
      </test>
      <test logic="AND" value="1">
	instruments/panel-lighting/backlight-intensity GT 0
	instruments/panel-lighting/backlight-intensity LE 1
      </test>
      <test value="2">
	instruments/panel-lighting/backlight-intensity GT 1
      </test>
    </switch>
  </channel>

  <channel name="Panel floodlight intensity">
    <switch name="instruments/panel-lighting/floodlight-intensity-cmd">
      <default value="instruments/panel-lighting/floodlight-intensity"/>
      <test value="0">
	instruments/panel-lighting/floodlight-status EQ 0
      </test>
      <test logic="OR" value="instruments/panel-lighting/floodlight-intensity">
	instruments/panel-lighting/floodlight-status EQ 1
	instruments/panel-lighting/floodlight-status EQ 2
      </test>
    </switch>
    <pure_gain name="instruments/panel-lighting/floodlight-intensity-norm">
      <input>instruments/panel-lighting/floodlight-intensity-cmd</input>
      <gain>1</gain>
      <clipto>
	<min>0</min>
	<max>1</max>
      </clipto>
    </pure_gain>
  </channel>

  <channel name="Ledlight status">
    <switch name="instruments/panel-lighting/ledlight-status">
      <default value="1"/>
      <test value="0">
	<!-- Off ledlight if electrical is off -->
	/systems/electrical/serviceable EQ 0
      </test>
    </switch>
  </channel>

  <!-- Needs to be connected with the IRCM instrument on the pedestal -->
  <channel name="IRCM indicators">
    <switch name="instruments/panel-lighting/ircm-auto">
      <!--default value="instruments/ircm/ircm-auto" /-->
      <default value="0"/>
    </switch>
    <switch name="instruments/panel-lighting/ircm-sys-engaged">
      <!--default value="instruments/ircm/ircm-sys-engaged" /-->
      <default value="0" />
    </switch>
  </channel>
  
</system>
